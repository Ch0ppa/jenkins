pipeline {
    agent {
        label 'windows-shared'
    }
    options {
    	skipDefaultCheckout()
    }
    environment {
        PROJECT_SOLUTION_NAME = 'aspnet-get-started.sln'
    }
	stages {
	stage('Checkout') {
            steps {
                bat "git clone https://github.com/Ch0ppa/jenkins.git ${BUILD_NUMBER}"
                }}
	stage('checkDir') {
            steps {
                bat "dir ${WORKSPACE}\\${BUILD_NUMBER}" 
                }}	
        stage('Building the project') {
            steps {
                bat "\"${tool 'MSBuild_VS2019community'}\\msbuild.exe\" ${WORKSPACE}\\${BUILD_NUMBER}\\${PROJECT_SOLUTION_NAME} -r -m -v:q -t:rebuild /p:RestorePackagesConfig=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:DeployOnBuild=true /p:PackageLocation=${WORKSPACE}\\${BUILD_NUMBER}.zip"
                }}
	stage('Archive') {
            steps {
                archiveArtifacts artifacts: "${BUILD_NUMBER}.zip", followSymlinks: false
                }}	
	stage('TransferToS3') {
            steps {
                powershell "aws s3 ls s3://transfer8884/stuff/"
            	}}
}
}
